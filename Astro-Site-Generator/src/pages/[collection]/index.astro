---
/* src/pages/[collection]/index.astro */
import CollectionLayout from '../../layouts/CollectionLayout.astro';
import CollectionCard from '../../components/CollectionsCard.astro'; // Ensure correct naming
import { fetchCollectionItems, formatCollectionName, generateCollectionPaths } from '../../utils/collections.js';

const { collection } = Astro.params;

// Fetch items from the specified collection
let items;
let pageTitle;
let pageDescription;

try {
  items = await fetchCollectionItems(collection);
  const formattedCollectionName = formatCollectionName(collection);
  pageTitle = `Our ${formattedCollectionName}`;
  pageDescription = `Explore our ${collection} and discover what we offer.`;
} catch (error) {
  // Redirect to custom 404 page if collection is not found
  Astro.redirect('/404');
}

// Export the getStaticPaths function
export async function getStaticPaths() {
  return await generateCollectionPaths();
}
---
<CollectionLayout title={pageTitle} description={pageDescription}>
  <header>
    <h1>{pageTitle}</h1>
    <p>{pageDescription}</p>
  </header>
  <main>
    <section class="collections-list">
      {items.map(item => (
        <CollectionCard
          key={item.id}
          title={item.data.title}
          description={item.data.description}
          slug={item.data.slug}
          icon={item.data.icon}
          collection={collection}
          featuredImage={item.data.featuredImage}
          price={item.data.price}
          date={item.data.date}
          author={item.data.author}
        />
      ))}
    </section>
  </main>
</CollectionLayout>

<style>
  .collections-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
    padding: 2rem 0;
  }
  header {
    text-align: center;
    padding: 2rem 0;
  }
</style>
