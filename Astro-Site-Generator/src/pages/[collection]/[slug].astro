---
import CollectionItemLayout from "../../layouts/CollectionItemLayout.astro";
import Section from "../../components/Section.astro";
import Image from "../../components/Image.astro";
import ContentTemplate from "../../components/ContentTemplate.astro";
import ItemsTemplate from "../../components/ItemsTemplate.astro";

import {
  getCollectionItemPageData,
  generateItemPaths,
} from "../../utils/collections/";

// Components for rendering references
import ServiceCard from "../../components/ServiceCard.astro";
import CollectionCard from "../../components/CollectionsCard.astro";

// Grabs [collection]/[slug] from the URL
const { collection, slug } = Astro.params;

let pageData;
try {
  pageData = await getCollectionItemPageData(collection, slug);
} catch (error) {
  console.error(error.message);
  Astro.redirect("/404");
}

export async function getStaticPaths() {
  return generateItemPaths();
}

const { title, description, icon, featuredImage, pageTitle } = pageData;
---

<CollectionItemLayout
  title={pageTitle}
  description={description}
  image={featuredImage}
>
  <!-- Main Content Section -->
  <Section className="main-content">
    <article>
      <header>
        <h1>{icon || "ðŸ“„"} {title}</h1>
        <p>{description}</p>
        {
          featuredImage && (
            <Image
              src={featuredImage}
              alt={`${title} Featured Image`}
              className="item-image"
            />
          )
        }
      </header>
      <p>Additional item-specific content goes here...</p>
    </article>
  </Section>

  <!-- Related Services -->
  <Section className="related-services">
    <ContentTemplate collection="services">
      <ItemsTemplate
        collection="services"
        ItemComponent={ServiceCard}
        queryName="RelatedServices"
        slug={slug}
        currentCollection={collection}
        columns={3}
      />
    </ContentTemplate>
  </Section>

  <!-- Related Projects -->
  <Section className="related-projects">
    <ContentTemplate collection="projects">
      <ItemsTemplate
        collection="projects"
        ItemComponent={CollectionCard}
        queryName="RelatedProjects"
        slug={slug}
        currentCollection={collection}
        columns={3}
      />
    </ContentTemplate>
  </Section>
</CollectionItemLayout>

<style>
  .item-image {
    max-width: 100%;
    height: auto;
    margin-top: 1rem;
    border-radius: 4px;
  }
  .main-content {
    /* custom styles */
  }
  .related-services,
  .related-projects {
    margin-top: 3rem;
  }
</style>
