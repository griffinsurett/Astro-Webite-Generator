---
// /[collection]/[slug].astro

// layout imports
import CollectionItemLayout from "../../layouts/CollectionItemLayout.astro";

// component imports
import Image from "../../components/Image.astro";

// utils imports
import {
  getCollectionItemPageData,
  generateItemPaths,
} from "../../utils/collections.js";

const { collection, slug } = Astro.params;

let pageData;

try {
  pageData = await getCollectionItemPageData(collection, slug);
} catch (error) {
  // Log the error for debugging purposes
  console.error(error.message);
  // Redirect to 404 if not found
  Astro.redirect("/404");
}

// Destructure data for easier access
const { title, description, icon, featuredImage, pageTitle } = pageData;

// Export the getStaticPaths function
export async function getStaticPaths() {
  return await generateItemPaths();
}
---

<CollectionItemLayout
  title={pageTitle}
  description={description}
  image={featuredImage}
>
  <article>
    <header>
      <h1>{icon || "ðŸ“„"} {title}</h1>
      <p>{description}</p>
      {
        featuredImage && (
          <Image
            src={featuredImage}
            alt={`${title} Featured Image`}
            className="item-image"
          />
        )
      }
    </header>
    <!-- Additional content can be added here -->
  </article>
</CollectionItemLayout>

<style>
  .item-image {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
    margin-top: 1rem;
  }
</style>
