---
// [collection]/[slug].astro

// layout import
import CollectionItemLayout from '../../layouts/CollectionItemLayout.astro';

// utils imports
import { getValidatedCollectionItem, formatCollectionName, generateItemPaths } from '../../utils/collections.js';

// components imports
import Image from '../../components/Image.astro'; // Import the Image component

const { collection, slug } = Astro.params;

// Fetch and validate the collection item
let item;
try {
  item = await getValidatedCollectionItem(collection, slug);
} catch (error) {
  // Redirect to 404 if not found
  Astro.redirect('/404');
}

// Destructure data for easier access
const { title, description, icon, featuredImage } = item;

// Set page metadata
const pageTitle = `${title} | ${formatCollectionName(collection)}`;

// Export the getStaticPaths function
export async function getStaticPaths() {
  return await generateItemPaths();
}
---
<CollectionItemLayout title={pageTitle} description={description} image={featuredImage}>
  <article>
    <header>
      <h1>{icon || 'ðŸ“„'} {title}</h1>
      <p>{description}</p>
      {featuredImage && <Image src={featuredImage} alt={`${title} Featured Image`} className="item-image" />}
    </header>
    <!-- Additional content can be added here -->
  </article>
</CollectionItemLayout>

<style>
  .item-image {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
    margin-top: 1rem;
  }
</style>
