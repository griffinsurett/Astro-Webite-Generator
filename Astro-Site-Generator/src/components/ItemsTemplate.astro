---
import { executeQuery } from "../utils/queries/executeQuery.js";

/**
 * ItemsTemplate.astro
 *
 * Props:
 * - collection: The name of the collection (optional)
 * - ItemComponent: The Astro component used to render each item
 * - queryName: The name of the query to run
 * - columns: Number of columns in the grid (if applicable)
 * - gap: Gap between grid items
 * - className: Additional CSS classes
 * - ...rest: any additional props to pass to the query (like slug, currentCollection)
 */
const {
  collection,
  ItemComponent,
  queryName,
  columns = 3,
  gap = '1.5rem',
  className = '',
  ...rest // This will catch any extra props (e.g. slug, currentCollection)
} = Astro.props;

// 1) If no queryName, error out
if (!queryName || typeof queryName !== 'string') {
  throw new Error(`A valid "queryName" prop must be provided to ItemsTemplate.`);
}

// 2) Execute the dynamic query, passing along any extra props
const items = await executeQuery(queryName, rest);

// 3) Render
const hasItems = Array.isArray(items) && items.length > 0;
---
{hasItems ? (
  <div class={`items-template ${className}`} style={`display: flex; gap: ${gap};`}>
    {items.map((item) => (
      <ItemComponent
        key={item.slug}
        {...item}
        collection={collection}
        hasSubmenu={item.hasSubmenu || false}
        submenuItems={item.submenuItems || []}
        currentPath={Astro.url.pathname}
      />
    ))}
  </div>
) : (
  <p class="no-items">No items available.</p>
)}

<style>
  .items-template {
    width: 100%;
  }
  .no-items {
    text-align: center;
    color: #666;
    font-style: italic;
    padding: 1rem 0;
  }
</style>
