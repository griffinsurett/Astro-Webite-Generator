---
import SubMenu from "./SubMenu.jsx";
import { executeQuery } from "../../../utils/queries/executeQuery.js"; // Ensure correct path

const { queryName, className = "" } = Astro.props;

// Fetch menu items based on the provided query
const menuItems = await executeQuery(queryName);
---

<nav class={`hierarchical-menu ${className}`} aria-label="Main Navigation">
  <ul class="menu-list" role="menubar">
    {menuItems.map((item) => (
      <li class="menu-item" role="none">
        <a href={item.href} class="menu-link" role="menuitem" aria-haspopup={item.children && item.children.length > 0 ? "true" : "false"} aria-expanded="false">
          <span class="menu-label">{item.label}</span>
          {item.children && item.children.length > 0 && (
            <span class="menu-arrow" aria-hidden="true">â–¼</span>
          )}
        </a>
        {item.children && item.children.length > 0 && (
          <SubMenu items={item.children} />
        )}
      </li>
    ))}
  </ul>
</nav>

<style>
  .hierarchical-menu {
    /* Container styles */
  }

  .menu-list {
    list-style: none;
    display: flex;
    gap: 1rem;
    margin: 0;
    padding: 0;
  }

  .menu-item {
    position: relative;
  }

  .menu-link {
    text-decoration: none;
    color: #333;
    padding: 0.5rem 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background-color 0.2s ease;
    min-width: 150px; /* Optional: Ensures consistent width */
  }

  .menu-link:hover,
  .menu-link:focus {
    background-color: #f0f0f0;
  }

  .menu-label {
    flex-grow: 1;
  }

  .menu-arrow {
    margin-left: 0.5rem;
    font-size: 0.8rem;
    transition: transform 0.3s ease;
  }

  /* Rotate arrow when submenu is open */
  .menu-item:hover > .menu-link > .menu-arrow,
  .menu-item:focus-within > .menu-link > .menu-arrow {
    transform: rotate(180deg);
  }

  /* Responsive Adjustments */
  @media (max-width: 768px) {
    .menu-list {
      flex-direction: column;
      gap: 0;
    }

    .menu-link {
      padding: 0.75rem 1rem;
    }

    .menu-arrow {
      margin-left: 0;
      margin-top: 0.25rem;
    }
  }
</style>
